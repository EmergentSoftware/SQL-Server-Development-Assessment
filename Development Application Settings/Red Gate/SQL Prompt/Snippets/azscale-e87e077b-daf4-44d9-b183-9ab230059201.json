{
  "id": "e87e077b-daf4-44d9-b183-9ab230059201",
  "prefix": "azscale",
  "description": "ES: Azure Database scale check and alter",
  "body": "SELECT\r\n    Edition          = DATABASEPROPERTYEX(DB_NAME(), 'EDITION')\r\n   ,ServiceObjective = DATABASEPROPERTYEX(DB_NAME(), 'ServiceObjective')\r\n   ,MaxSizeInGB      = CONVERT(bigint, DATABASEPROPERTYEX(DB_NAME(), 'MaxSizeInBytes')) / 1024 / 1024 / 1024\r\n   ,CurrentSizeInGB  = (SELECT (SUM(CAST((size * 8.0 / 1024 / 1024) AS decimal(15, 2))))FROM sys.database_files);\r\n\r\n/*\r\n-- Edition          Basic\r\n--                  Standard\r\n--                  Premium\r\n-- ServiceObjective Basic    = Basic (5 DTU)\r\n--                  Standard = S0 (10 DTU), S1 (20 DTU), S2 (50 DTU), S3 (100 DTU), S4 (200 DTU), S6 (400 DTU), S7 (800 DTU), S9 (1600 DTU), S12 (3000 DTU)\r\n--                  Premium  = P1 (125 DTU), P2 (250 DTU), P4 (500 DTU), P6 (1000 DTU), P11 (1750 DTU), P15 (4000 DTU)\r\n-- MaxSizeInGB      Basic    = 2\r\n--                  Standard = 0.1 - 1024\r\n--                  Premium  = 0.1 = 4096\r\n\r\nDECLARE\r\n    @Edition          AS nvarchar(MAX) = N'Basic'\r\n   ,@ServiceObjective AS nvarchar(MAX) = N'Basic'\r\n   ,@MaxSizeInGB      AS nvarchar(MAX) = N'2';\r\n\r\nDECLARE @StringToExecute AS nvarchar(MAX) = N'';\r\n\r\nSET @StringToExecute = N'ALTER DATABASE [' + DB_NAME() + N'] MODIFY (EDITION = ''' + @Edition + N''', MAXSIZE = ' + @MaxSizeInGB + N' GB, SERVICE_OBJECTIVE = ''' + @ServiceObjective + N''');';\r\n\r\nSELECT @StringToExecute;\r\n\r\nEXECUTE sp_executesql @stmt = @StringToExecute;\r\n*/"
}